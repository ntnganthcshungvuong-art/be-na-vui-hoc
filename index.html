<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¸ BÃ© Na Vui Há»c ğŸŒ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap');
    body { font-family: 'Baloo 2', sans-serif; }

    /* Popup Ä‘á»™ng viÃªn */
    .encouragement {
      position: fixed;
      bottom: 20px;
      right: 20px;
      max-width: 250px;
      background: rgba(255,255,255,0.95);
      border: 2px solid #fca5a5;
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      animation: fadeInOut 3s ease forwards;
      z-index: 999;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; }
      100% { opacity: 0; transform: translateY(20px); }
    }

    /* Rá»±c rá»¡ Ä‘Ã¡p Ã¡n */
    .option-button {
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 1rem;
      font-size: 1.2rem;
      font-weight: 700;
      color: #fff;
      transition: transform 0.2s;
      width: 100%;
      display: block;
    }
    .option-button:nth-child(1){background:linear-gradient(135deg,#f59e0b,#fbbf24);}
    .option-button:nth-child(2){background:linear-gradient(135deg,#3b82f6,#60a5fa);}
    .option-button:nth-child(3){background:linear-gradient(135deg,#10b981,#34d399);}
    .option-button:nth-child(4){background:linear-gradient(135deg,#ec4899,#f472b6);}
    .option-button:hover{transform:scale(1.05);}
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-yellow-50 to-blue-100">

  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-4xl font-extrabold text-center mb-6 text-purple-700 animate-bounce">
      ğŸŒ¸ BÃ© Na Vui Há»c ğŸŒ¸
    </h1>

    <!-- MÃ n hÃ¬nh chÃ­nh -->
    <div id="homeScreen">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6">
        <button onclick="startSubject('toan2.json','ğŸ”¢ ToÃ¡n 2')" class="p-5 rounded-2xl bg-blue-500 text-white font-bold">ğŸ”¢<br>ToÃ¡n 2</button>
        <button onclick="startSubject('tiengviet2.json','ğŸ“˜ Tiáº¿ng Viá»‡t 2')" class="p-5 rounded-2xl bg-green-500 text-white font-bold">ğŸ“˜<br>Tiáº¿ng Viá»‡t 2</button>
        <button onclick="startSubject('tnxh2.json','ğŸŒ± Tá»± nhiÃªn & XÃ£ há»™i 2')" class="p-5 rounded-2xl bg-yellow-500 text-white font-bold">ğŸŒ±<br>Tá»± nhiÃªn & XÃ£ há»™i 2</button>
        <button onclick="startSubject('tienganh2.json','ğŸŒ English 2')" class="p-5 rounded-2xl bg-red-500 text-white font-bold">ğŸŒ<br>English 2</button>
        <button onclick="startSubject('honhop.json','ğŸ² Há»—n há»£p')" class="p-5 rounded-2xl bg-purple-500 text-white font-bold">ğŸ²<br>Há»—n há»£p</button>
      </div>
    </div>

    <!-- MÃ n hÃ¬nh chÆ¡i -->
    <div id="gameScreen" style="display:none;">
      <div class="bg-white rounded-2xl p-6 shadow-md">
        <div id="questionEmoji" class="text-5xl text-center mb-4">ğŸ¤”</div>
        <h2 id="questionDisplay" class="text-2xl font-bold text-center mb-6">CÃ¢u há»i...</h2>
        <div id="optionsContainer" class="space-y-3"></div>
        <div id="fillBlankContainer" style="display:none;" class="text-center"></div>
        <div id="dragDropContainer" style="display:none;" class="text-center"></div>
      </div>
    </div>

    <!-- MÃ n hÃ¬nh káº¿t quáº£ -->
    <div id="resultScreen" style="display:none;">
      <div class="bg-white rounded-2xl p-6 text-center shadow-md">
        <div id="resultEmoji" class="text-6xl mb-4">ğŸ†</div>
        <h2 id="resultTitle" class="text-2xl font-bold mb-4">Káº¿t quáº£</h2>
        <div id="scoreDisplay" class="text-xl font-bold mb-2">0/0</div>
        <div id="percentDisplay" class="text-lg text-gray-700">0%</div>
        <div class="mt-4">
          <button onclick="goHome()" class="px-6 py-3 bg-purple-500 text-white rounded-xl">ğŸ  Trang chá»§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup Ä‘á»™ng viÃªn -->
  <div id="encouragementMessage" class="encouragement" style="display:none;">
    <div class="text-center">
      <div class="text-lg font-bold text-red-600">Sai rá»“i!</div>
      <div class="text-sm text-gray-700">ÄÃ¡p Ã¡n Ä‘Ãºng sáº½ hiá»‡n nhÃ© ğŸŒŸ</div>
    </div>
  </div>

<script>
let questions = [];
let currentIndex = 0, score = 0;

function startSubject(file, title) {
  fetch('data/' + file)
    .then(r=>r.json())
    .then(data=>{
      questions = shuffleArray(data).slice(0,10);
      currentIndex=0; score=0;
      document.getElementById('homeScreen').style.display="none";
      document.getElementById('resultScreen').style.display="none";
      document.getElementById('gameScreen').style.display="block";
      displayQuestion();
    });
}

function displayQuestion() {
  const q = questions[currentIndex];
  document.getElementById('questionEmoji').textContent = q.emoji||'â“';
  document.getElementById('questionDisplay').textContent = q.q;
  document.getElementById('optionsContainer').style.display='none';
  document.getElementById('fillBlankContainer').style.display='none';
  document.getElementById('dragDropContainer').style.display='none';

  if(q.type==="multiple"){
    let container=document.getElementById('optionsContainer');
    container.innerHTML='';
    q.options.forEach((opt,i)=>{
      let btn=document.createElement('button');
      btn.className='option-button';
      btn.textContent = opt;
      btn.onclick=()=>selectOption(i,q);
      container.appendChild(btn);
    });
    container.style.display='block';
  } else if(q.type==="fill"){
    let container=document.getElementById('fillBlankContainer');
    container.innerHTML=`
      <input id="fillInput" class="border p-2 rounded w-2/3 text-center" placeholder="Äiá»n Ä‘Ã¡p Ã¡n..."><br>
      <button onclick="checkFill('${q.answer}')" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded">Kiá»ƒm tra</button>
    `;
    container.style.display='block';
  } else if(q.type==="drag"){
    let container=document.getElementById('dragDropContainer');
    container.innerHTML=`
      <div id="dropZone" class="border-2 border-dashed p-6 mb-4">KÃ©o Ä‘Ã¡p Ã¡n vÃ o Ä‘Ã¢y</div>
      <div class="flex flex-wrap gap-2 justify-center">
        ${q.dragItems.map(opt=>`<div class="px-4 py-2 bg-pink-300 rounded cursor-move" draggable="true" ondragstart="drag(event)" data="${opt}">${opt}</div>`).join('')}
      </div>
    `;
    container.style.display='block';
    document.getElementById('dropZone').ondrop=function(ev){ev.preventDefault(); let v=ev.dataTransfer.getData("text"); checkAnswer(v===q.answer,q);};
    document.getElementById('dropZone').ondragover=function(ev){ev.preventDefault();};
  }
}

function selectOption(index,q){
  const buttons=document.querySelectorAll('#optionsContainer button');
  buttons.forEach((btn,i)=>{
    btn.disabled=true;
    if(i===q.answer){
      btn.className='w-full block px-4 py-3 rounded-xl font-bold bg-green-500 text-white';
    }else if(i===index){
      btn.className='w-full block px-4 py-3 rounded-xl font-bold bg-red-500 text-white';
    }else{
      btn.className='w-full block px-4 py-3 rounded-xl bg-gray-200 text-gray-600';
    }
  });
  if(index===q.answer){ score++; fireworks(); }
  else { showEncouragement(q.options[q.answer]); }
  setTimeout(()=>{nextQuestion();},2000);
}

function checkAnswer(correct,q){
  if(correct){ score++; fireworks(); }
  else { showEncouragement(q.answer); }
  setTimeout(()=>{ nextQuestion(); },2000);
}
function checkFill(ans){
  let v=document.getElementById('fillInput').value.trim();
  checkAnswer(v.toLowerCase()===ans.toLowerCase(), {answer:ans});
}
function nextQuestion(){
  currentIndex++;
  if(currentIndex<questions.length){ displayQuestion(); }
  else { showResults(); }
}
function showResults(){
  let percent=Math.round(score/questions.length*100);
  document.getElementById('gameScreen').style.display="none";
  document.getElementById('resultScreen').style.display="block";
  document.getElementById('scoreDisplay').textContent=`${score}/${questions.length}`;
  document.getElementById('percentDisplay').textContent=`${percent}% ${percent>=90?"ğŸ† Xuáº¥t sáº¯c!":percent>=70?"ğŸŒŸ Tá»‘t láº¯m!":percent>=50?"ğŸ‘ KhÃ¡ tá»‘t!":"ğŸ’ª Cá»‘ gáº¯ng hÆ¡n nhÃ©!"}`;
}
function goHome(){
  document.getElementById('homeScreen').style.display="block";
  document.getElementById('gameScreen').style.display="none";
  document.getElementById('resultScreen').style.display="none";
}
function showEncouragement(correctAns){
  let box=document.getElementById('encouragementMessage');
  box.style.display="block";
  box.querySelector('.text-sm').innerHTML=`ÄÃ¡p Ã¡n Ä‘Ãºng: <b>${correctAns}</b>`;
  setTimeout(()=>{box.style.display="none";},2500);
}
function fireworks(){
  let e=document.createElement('div');
  e.style.position='fixed'; e.style.left='50%'; e.style.top='50%';
  e.style.transform='translate(-50%,-50%)';
  e.style.fontSize='3rem'; e.textContent='ğŸ‰';
  document.body.appendChild(e);
  setTimeout(()=>document.body.removeChild(e),1000);
}
function shuffleArray(a){return a.map(x=>({x,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(({x})=>x);}

// Fix kÃ©o xuá»‘ng reload
document.addEventListener('touchmove', function (e) {
  if (window.scrollY === 0 && e.touches[0].clientY > 50) {
    e.preventDefault();
  }
}, { passive: false });
</script>
</body>
</html>
