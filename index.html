<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¸ BÃ© Na Vui Há»c ğŸŒ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Comic Sans MS', cursive; background: linear-gradient(135deg, #ffe4f3, #fffce0, #e0f7fa); }
    .marquee { width: 100%; overflow: hidden; white-space: nowrap; box-sizing: border-box; }
    .marquee span { display: inline-block; padding-left: 100%; animation: marquee 12s linear infinite; font-size: 1.5rem; color: #d63384; font-weight: bold;}
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
    .subject-btn { font-size: 1.5rem; font-weight: bold; padding: 1.5rem; border-radius: 1rem; transition: 0.3s; }
    .subject-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(0,0,0,0.3); }
    .option-btn { font-size: 1.5rem; padding: 1rem; border-radius: 0.75rem; width: 100%; margin: 0.5rem 0; transition: 0.3s; }
    .option-btn:hover { transform: scale(1.05); }
    .firework { position: fixed; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; animation: explode 1s ease-out forwards; }
    @keyframes explode { from { transform: scale(0); opacity: 1; } to { transform: scale(20); opacity: 0; } }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Nháº¡c -->
  <audio id="bgMusic" src="assets/bg-music.mp3" loop></audio>
  <audio id="correctSound" src="assets/correct.mp3"></audio>
  <audio id="wrongSound" src="assets/wrong.mp3"></audio>

  <!-- Header -->
  <div class="bg-pink-300 py-3 marquee"><span>ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ BÃ© Na Vui Há»c ğŸŒ¸ ğŸŒ¸ ğŸŒ¸</span></div>

  <!-- MÃ n hÃ¬nh chÃ­nh -->
  <div id="home" class="flex-grow flex flex-col justify-center items-center">
    <h1 class="text-4xl font-extrabold text-purple-700 mb-6">Chá»n mÃ´n há»c</h1>
    <div class="grid grid-cols-2 gap-6 max-w-lg">
      <button onclick="chooseMode('toan2.json','ğŸ”¢ ToÃ¡n 2')" class="subject-btn bg-blue-400 text-white">ğŸ”¢ ToÃ¡n 2</button>
      <button onclick="chooseMode('tiengviet2.json','ğŸ“˜ Tiáº¿ng Viá»‡t 2')" class="subject-btn bg-green-400 text-white">ğŸ“˜ Tiáº¿ng Viá»‡t 2</button>
      <button onclick="chooseMode('tnxh2.json','ğŸŒ± Tá»± nhiÃªn & XH 2')" class="subject-btn bg-yellow-400 text-white">ğŸŒ± Tá»± nhiÃªn & XH 2</button>
      <button onclick="chooseMode('tienganh2.json','ğŸŒ English 2')" class="subject-btn bg-red-400 text-white">ğŸŒ English 2</button>
      <button onclick="chooseMode('mixed','ğŸ² Há»—n há»£p')" class="col-span-2 subject-btn bg-purple-500 text-white">ğŸ² Há»—n há»£p</button>
      <button onclick="showAchievements()" class="col-span-2 subject-btn bg-pink-500 text-white">ğŸ† ThÃ nh tá»±u</button>
    </div>
  </div>

  <!-- MÃ n hÃ¬nh chá»n cháº¿ Ä‘á»™ -->
  <div id="modeSelect" class="hidden flex-grow flex flex-col justify-center items-center text-center">
    <h2 id="modeTitle" class="text-3xl font-bold mb-6"></h2>
    <button onclick="startGame('normal')" class="subject-btn bg-green-500 text-white mb-4">ğŸ® ChÆ¡i 10 cÃ¢u</button>
    <button onclick="startGame('practice')" class="subject-btn bg-orange-500 text-white mb-4">ğŸ¯ Luyá»‡n táº­p vÃ´ háº¡n</button>
    <button onclick="goHome()" class="subject-btn bg-gray-500 text-white">ğŸ  Vá» trang chá»§</button>
  </div>

  <!-- MÃ n hÃ¬nh game -->
  <div id="game" class="hidden flex-grow flex flex-col justify-center items-center text-center px-4">
    <h2 id="subjectTitle" class="text-3xl font-bold mb-6"></h2>
    <p id="question" class="text-2xl mb-6"></p>
    <div id="options" class="w-full max-w-md"></div>
    <p id="progress" class="mt-4 text-lg text-gray-600"></p>
  </div>

  <!-- MÃ n hÃ¬nh káº¿t quáº£ -->
  <div id="result" class="hidden flex-grow flex flex-col justify-center items-center text-center">
    <h2 class="text-3xl font-bold mb-4">Káº¿t quáº£</h2>
    <p id="score" class="text-2xl mb-4"></p>
    <button onclick="goHome()" class="subject-btn bg-gray-500 text-white">ğŸ  Vá» trang chá»§</button>
  </div>

  <!-- MÃ n hÃ¬nh thÃ nh tá»±u -->
  <div id="achievements" class="hidden flex-grow p-6">
    <h2 class="text-3xl font-bold text-center mb-6">ğŸ† ThÃ nh tá»±u cá»§a BÃ© Na</h2>
    <div id="achievementsList" class="space-y-4"></div>
    <div class="text-center mt-6">
      <button onclick="goHome()" class="subject-btn bg-gray-500 text-white">ğŸ  Vá» trang chá»§</button>
    </div>
  </div>

  <script>
    const home = document.getElementById("home");
    const modeSelect = document.getElementById("modeSelect");
    const game = document.getElementById("game");
    const result = document.getElementById("result");
    const achievements = document.getElementById("achievements");
    const bgMusic = document.getElementById("bgMusic");
    const correctSound = document.getElementById("correctSound");
    const wrongSound = document.getElementById("wrongSound");

    let questions = [];
    let current = 0;
    let score = 0;
    let subject = "";
    let mode = "normal"; // normal = 10 cÃ¢u, practice = vÃ´ háº¡n
    let dataFile = "";

    function chooseMode(file, title) {
      home.classList.add("hidden");
      modeSelect.classList.remove("hidden");
      document.getElementById("modeTitle").innerText = `Chá»n cháº¿ Ä‘á»™ cho ${title}`;
      subject = title;
      dataFile = file;
    }

    function startGame(selectedMode) {
      mode = selectedMode;
      modeSelect.classList.add("hidden");
      game.classList.remove("hidden");
      document.getElementById("subjectTitle").innerText = subject;

      if (dataFile === "mixed") {
        Promise.all([
          fetch("data/toan2.json").then(r=>r.json()),
          fetch("data/tiengviet2.json").then(r=>r.json()),
          fetch("data/tnxh2.json").then(r=>r.json()),
          fetch("data/tienganh2.json").then(r=>r.json())
        ]).then(all => {
          questions = [].concat(...all);
          startQuiz();
        });
      } else {
        fetch("data/" + dataFile).then(r=>r.json()).then(data=>{
          questions = data;
          startQuiz();
        });
      }
      bgMusic.play();
    }

    function startQuiz() {
      current = 0;
      score = 0;
      if (mode === "normal") {
        questions = shuffle(questions).slice(0,10);
      } else {
        questions = shuffle(questions);
      }
      showQuestion();
    }

    function showQuestion() {
      if (mode === "normal" && current >= 10) { endGame(); return; }
      if (mode === "practice" && questions.length === 0) {
        // refill khi luyá»‡n táº­p
        fetchDataAgain();
        return;
      }

      const q = questions[current % questions.length];
      document.getElementById("question").innerText = q.q;
      document.getElementById("options").innerHTML = "";
      q.options.forEach((opt,i)=>{
        const btn = document.createElement("button");
        btn.className = "option-btn bg-white border";
        btn.innerText = opt;
        btn.onclick = ()=>checkAnswer(i, q.answer, btn);
        document.getElementById("options").appendChild(btn);
      });
      document.getElementById("progress").innerText = (mode==="normal") ? `CÃ¢u ${current+1}/10` : `CÃ¢u sá»‘ ${current+1}`;
    }

    function checkAnswer(i, correct, btn) {
      if (i === correct) {
        score++;
        btn.classList.add("bg-green-400","text-white");
        correctSound.play();
        fireworks();
      } else {
        btn.classList.add("bg-red-400","text-white");
        wrongSound.play();
      }
      setTimeout(()=>{
        current++;
        showQuestion();
      },1000);
    }

    function endGame() {
      game.classList.add("hidden");
      result.classList.remove("hidden");
      document.getElementById("score").innerText = `BÃ© lÃ m Ä‘Ãºng ${score}/10 cÃ¢u`;

      const all = JSON.parse(localStorage.getItem("achievements")||"[]");
      all.push({subject, score, mode, date:new Date().toLocaleString("vi-VN")});
      localStorage.setItem("achievements", JSON.stringify(all));
    }

    function showAchievements() {
      home.classList.add("hidden");
      achievements.classList.remove("hidden");
      const list = document.getElementById("achievementsList");
      const all = JSON.parse(localStorage.getItem("achievements")||"[]");
      if (all.length===0) {
        list.innerHTML = "<p class='text-center text-gray-500'>ChÆ°a cÃ³ thÃ nh tá»±u nÃ o ğŸŒ¸</p>";
      } else {
        list.innerHTML = all.map(a=>`
          <div class="p-4 bg-white shadow rounded">
            <p><b>${a.subject}</b> (${a.mode==="normal"?"10 cÃ¢u":"Luyá»‡n táº­p"})</p>
            <p>Äiá»ƒm: ${a.score}</p>
            <p class="text-sm text-gray-500">${a.date}</p>
          </div>`).join("");
      }
    }

    function goHome() {
      home.classList.remove("hidden");
      modeSelect.classList.add("hidden");
      game.classList.add("hidden");
      result.classList.add("hidden");
      achievements.classList.add("hidden");
    }

    function shuffle(arr) { return arr.sort(()=>Math.random()-0.5); }

    function fireworks() {
      const colors=["#ff6b6b","#ffd93d","#6bcBef","#51cf66","#845ef7"];
      for (let i=0;i<10;i++) {
        const fw=document.createElement("div");
        fw.className="firework";
        fw.style.left=Math.random()*100+"%";
        fw.style.top=Math.random()*100+"%";
        fw.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        document.body.appendChild(fw);
        setTimeout(()=>fw.remove(),1000);
      }
    }

    function fetchDataAgain() {
      fetch("data/" + dataFile).then(r=>r.json()).then(data=>{
        questions = shuffle(data);
        showQuestion();
      });
    }
  </script>
</body>
</html>
