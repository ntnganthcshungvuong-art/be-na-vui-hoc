<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌸 Bé Na Vui Học 🌸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Comic Sans MS', cursive; }
    .marquee { width:100%; overflow:hidden; white-space:nowrap; animation: marquee 12s linear infinite; }
    @keyframes marquee { 0% { text-indent:100% } 100% { text-indent:-100% } }
    .celebrate { animation: pop 0.6s ease; }
    @keyframes pop { 0%{transform:scale(0.5);opacity:0;} 100%{transform:scale(1);opacity:1;} }
    .btn { font-size:1.5rem; padding:1rem 2rem; border-radius:1rem; }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-yellow-50 to-purple-100 min-h-screen flex flex-col">

  <!-- Header -->
  <div class="bg-pink-400 py-3 text-center text-white font-bold text-xl shadow">
    <div class="marquee">🌸🌸🌸 Bé Na Vui Học 🌸🌸🌸</div>
  </div>

  <!-- Home -->
  <div id="home" class="flex-grow flex flex-col items-center justify-center space-y-6">
    <h1 class="text-3xl font-extrabold text-purple-700 mb-6">Chọn môn học</h1>
    <div class="grid grid-cols-1 gap-4">
      <button onclick="startGame('data/toan2.json','🔢 Toán 2')" class="btn bg-blue-500 text-white shadow">🔢 Toán 2</button>
      <button onclick="startGame('data/tiengviet2.json','📘 Tiếng Việt 2')" class="btn bg-green-500 text-white shadow">📘 Tiếng Việt 2</button>
      <button onclick="startGame('data/tnxh2.json','🌱 Tự nhiên & XH 2')" class="btn bg-yellow-500 text-white shadow">🌱 Tự nhiên & XH 2</button>
      <button onclick="startGame('data/tienganh2.json','🌍 English 2')" class="btn bg-purple-500 text-white shadow">🌍 English 2</button>
      <button onclick="startGame('mixed','🎲 Hỗn hợp')" class="btn bg-pink-500 text-white shadow">🎲 Hỗn hợp</button>
    </div>
    <button onclick="toggleMusic()" class="mt-6 px-6 py-3 bg-red-400 text-white rounded-full">🎵 Bật/Tắt nhạc nền</button>
  </div>

  <!-- Game -->
  <div id="game" style="display:none;" class="flex-grow flex flex-col items-center justify-center p-4 space-y-6">
    <h2 id="subject" class="text-3xl font-bold text-purple-700"></h2>
    <div id="question" class="text-2xl text-center"></div>
    <div id="options" class="grid gap-4 w-full max-w-md"></div>
    <div id="progress" class="text-lg text-gray-600"></div>
  </div>

  <!-- Result -->
  <div id="result" style="display:none;" class="flex-grow flex flex-col items-center justify-center space-y-4">
    <div id="emoji" class="text-6xl"></div>
    <h2 id="summary" class="text-2xl font-bold"></h2>
    <button onclick="backHome()" class="px-8 py-4 bg-pink-400 rounded-full text-white text-xl">🏠 Về trang chủ</button>
  </div>

<script>
let questions=[], current=0, score=0;
let bgm = new Audio("assets/bg-music.mp3");
bgm.loop = true;
let soundCorrect = new Audio("assets/correct.mp3");
let soundWrong = new Audio("assets/wrong.mp3");

async function startGame(file, subject) {
  document.getElementById('home').style.display='none';
  document.getElementById('game').style.display='flex';
  document.getElementById('subject').innerText = subject;

  if (file === 'mixed') {
    const files = ['data/toan2.json','data/tiengviet2.json','data/tnxh2.json','data/tienganh2.json'];
    let all = [];
    for (let f of files) {
      let res = await fetch(f); let js = await res.json(); all = all.concat(js);
    }
    questions = shuffle(all).slice(0,10);
  } else {
    let res = await fetch(file); questions = await res.json();
    questions = shuffle(questions).slice(0,10);
  }
  current=0; score=0; showQuestion();
}

function showQuestion(){
  let q=questions[current];
  document.getElementById('question').innerText=q.q;
  let opt=document.getElementById('options'); opt.innerHTML='';
  q.options.forEach((o,i)=>{
    let b=document.createElement('button');
    b.className="p-4 text-xl bg-white rounded-xl shadow hover:bg-purple-100 w-full";
    b.innerText=o; 
    b.onclick=()=>check(i===q.answer);
    opt.appendChild(b);
  });
  document.getElementById('progress').innerText=`Câu ${current+1}/${questions.length}`;
}

function check(correct){
  if(correct){ score++; soundCorrect.play(); celebrate("🎉 Đúng rồi!"); }
  else { soundWrong.play(); celebrate("💔 Sai mất rồi!"); }
  setTimeout(()=>{ current++; (current<questions.length)?showQuestion():endGame(); },1500);
}

function celebrate(msg){
  let q=document.getElementById('question');
  q.innerText=msg;
  q.classList.add("celebrate");
  setTimeout(()=>q.classList.remove("celebrate"),600);
}

function endGame(){
  document.getElementById('game').style.display='none';
  document.getElementById('result').style.display='flex';
  document.getElementById('emoji').innerText = score>=8?"🏆":score>=5?"🌟":"💪";
  document.getElementById('summary').innerText = `Bé trả lời đúng ${score}/${questions.length} câu`;
}

function backHome(){
  document.getElementById('result').style.display='none';
  document.getElementById('home').style.display='flex';
}

function shuffle(a){return a.sort(()=>Math.random()-0.5);}

function toggleMusic(){
  if(bgm.paused){ bgm.play(); } else { bgm.pause(); }
}
</script>
</body>
</html>
